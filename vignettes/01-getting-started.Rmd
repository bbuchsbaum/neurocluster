---
title: Getting started with neurocluster
name: getting-started
description: Quick tour of the core workflow.
output:
  rmarkdown::html_vignette:
    toc: yes
    toc_depth: 2
params:
  family: red
  base_size: 13
  content_width: 72
vignette: |
  %\VignetteIndexEntry{Getting started with neurocluster} %\VignetteEngine{knitr::rmarkdown} %\VignetteEncoding{UTF-8}
css: albers.css
resource_files:
- albers.css
- albers.js
includes:
  in_header: |-
    <link rel="stylesheet" href="albers.css" />
    <script src="albers.js"></script>
    <script>document.addEventListener('DOMContentLoaded',()=>document.body.classList.add('palette-red'));</script>

---

```{r setup, include=FALSE}
if (requireNamespace("ggplot2", quietly = TRUE) && requireNamespace("albersdown", quietly = TRUE)) ggplot2::theme_set(albersdown::theme_albers(params$family))
if (requireNamespace("ggplot2", quietly = TRUE) && requireNamespace("albersdown", quietly = TRUE)) ggplot2::theme_set(albersdown::theme_albers(params$family))
if (requireNamespace("albersdown", quietly = TRUE)) ggplot2::theme_set(albersdown::theme_albers(params$family))
knitr::opts_chunk$set(
  collapse = TRUE, comment = "#>", fig.align = "center", fig.retina = 2,
  out.width = "100%", fig.width = 7, fig.asp = 0.618,
  message = FALSE, warning = FALSE
)
set.seed(123); options(pillar.sigfig = 7, width = 80)
suppressWarnings(suppressPackageStartupMessages({
  library(neurocluster)
  library(neuroim2)
}))
if (requireNamespace("albersdown", quietly = TRUE) && requireNamespace("ggplot2", quietly = TRUE)) {
  ggplot2::theme_set(albersdown::theme_albers(params$family, base_size = params$base_size))
}
if (file.exists("albers.css")) {
  cat(sprintf("<style>\n%s\n</style>", paste(readLines("albers.css", warn = FALSE), collapse = "\n")))
}
cat(sprintf('<script>document.addEventListener("DOMContentLoaded",function(){document.body.classList.add("palette-%s");});</script>', params$family))
cat(sprintf('<style>:root{--content:%sch}</style>', params$content_width))
```

```{r albers_inject, echo=FALSE, results='asis'}
if (file.exists("albers.css")) {
  cat(sprintf("<style>\n%s\n</style>", paste(readLines("albers.css", warn = FALSE), collapse = "\n")))
}
cat(sprintf('<script>document.addEventListener("DOMContentLoaded",function(){document.body.classList.add("palette-%s");});</script>', params$family))
cat(sprintf('<style>:root{--content:%sch}</style>', params$content_width))
```

# Goal {#goal}
Cluster a small 4D volume (3D space × time) into a few spatially coherent parcels, inspect the result, and export a NIfTI file.

# TL;DR {#tldr}
```r
# Create a small but structured synthetic dataset
syn <- generate_synthetic_volume(
  scenario = "gaussian_blobs",
  dims = c(10, 10, 6),
  n_clusters = 4,
  n_time = 24,
  seed = 42
)

# Minimal clustering: SNIC is fast on small data
result <- cluster4d(syn$vec, syn$mask, n_clusters = 4, method = "snic", max_iterations = 1)
```

# Setup {#setup}
```{r data-setup}
syn <- generate_synthetic_volume(
  scenario = "gaussian_blobs",
  dims = c(10, 10, 6),
  n_clusters = 4,
  n_time = 24,
  seed = 42
)
brain_mask <- syn$mask
vec  <- syn$vec
```

# Peek at the ground truth {#truth}
```{r truth-peek, fig.cap='Ground-truth Gaussian blobs (axial slice).', fig.alt='Axial slice showing four distinct clusters.'}
# Display the ground truth cluster labels
truth_array <- array(syn$truth, dim = syn$dims)
image(truth_array[,,3], col = rainbow(syn$n_clusters),
      main = "Ground Truth: Slice 3", axes = FALSE)
```

# Walkthrough {#walkthrough}
```r
result <- cluster4d(vec, mask, n_clusters = 4)
print(result)
summary(result)
plot(result)
```

# Quick visual (toy blocks) {#quick-visual}
Here’s a scikit-learn-style “blobs” example: three vertical bands with distinct time courses plus light noise. It’s tiny, deterministic, and easy to see what the algorithm is doing.

```{r quick-visual, fig.cap='Blocky synthetic with three temporal signatures. SNIC recovers the spatial bands cleanly.', fig.alt='Axial slice showing three contiguous colored bands.'}
toy <- make_block_synthetic(dims = c(12, 12, 1), ntime = 60, noise = 0.1, seed = 7)
toy_res <- cluster4d(
  toy$vec, toy$mask, n_clusters = 3,
  method = "snic", max_iterations = 1
)
plot(toy_res, slice = c(1, 1, 1), view = "axial")
```

# Export {#export}
```r
writeVol(result$clusvol, "clusters.nii.gz")
```

# See also {#see-also}
- Compare methods: articles/compare-methods.html#run-methods
- Choose parameters: articles/choose-parameters.html#heuristics
- Visualize & export: articles/visualize-export.html#plot
