<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Find G3S Seeds via Functional Gradient Minima — find_gradient_seeds_g3s • neurocluster</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><script src="../extra.js"></script><meta property="og:title" content="Find G3S Seeds via Functional Gradient Minima — find_gradient_seeds_g3s"><meta name="description" content="Identifies optimal seed locations for G3S clustering by finding local minima
in the functional gradient field. Unlike uniform grid seeding, this approach
places seeds in the centers of stable functional regions rather than on boundaries."><meta property="og:description" content="Identifies optimal seed locations for G3S clustering by finding local minima
in the functional gradient field. Unlike uniform grid seeding, this approach
places seeds in the centers of stable functional regions rather than on boundaries."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">neurocluster</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><h6 class="dropdown-header" data-toc-skip>Tutorials</h6></li>
    <li><a class="dropdown-item" href="../articles/01-getting-started.html">Getting Started</a></li>
    <li><a class="dropdown-item" href="../articles/02-compare-methods.html">Compare Methods</a></li>
    <li><a class="dropdown-item" href="../articles/03-end-to-end-export.html">End-to-End Export</a></li>
    <li><h6 class="dropdown-header" data-toc-skip>How-tos</h6></li>
    <li><a class="dropdown-item" href="../articles/10-choose-parameters.html">Choose Parameters</a></li>
    <li><a class="dropdown-item" href="../articles/11-speed-parallel.html">Speed &amp; Parallel</a></li>
    <li><a class="dropdown-item" href="../articles/12-visualize-export.html">Visualize &amp; Export</a></li>
    <li><a class="dropdown-item" href="../articles/13-consensus-stitch.html">Consensus &amp; Stitching</a></li>
    <li><a class="dropdown-item" href="../articles/14-validate-compare.html">Validate &amp; Compare</a></li>
    <li><a class="dropdown-item" href="../articles/15-legacy-apis.html">Legacy APIs</a></li>
    <li><h6 class="dropdown-header" data-toc-skip>Explanations</h6></li>
    <li><a class="dropdown-item" href="../articles/20-spatially-constrained-clustering.html">Spatially Constrained Clustering</a></li>
    <li><a class="dropdown-item" href="../articles/21-method-deep-dives.html">Method Deep Dives</a></li>
    <li><a class="dropdown-item" href="../articles/22-performance-memory.html">Performance &amp; Memory</a></li>
    <li><a class="dropdown-item" href="../articles/25-benchmarks.html">Benchmarks</a></li>
    <li><h6 class="dropdown-header" data-toc-skip>Reference Maps</h6></li>
    <li><a class="dropdown-item" href="../articles/30-api-overview.html">API Overview</a></li>
    <li><a class="dropdown-item" href="../articles/31-objects-results.html">Objects &amp; Results</a></li>
  </ul></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Find G3S Seeds via Functional Gradient Minima</h1>

      <div class="d-none name"><code>find_gradient_seeds_g3s.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Identifies optimal seed locations for G3S clustering by finding local minima
in the functional gradient field. Unlike uniform grid seeding, this approach
places seeds in the centers of stable functional regions rather than on boundaries.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">find_gradient_seeds_g3s</span><span class="op">(</span></span>
<span>  <span class="va">feature_mat</span>,</span>
<span>  <span class="va">coords</span>,</span>
<span>  <span class="va">K</span>,</span>
<span>  k_neighbors <span class="op">=</span> <span class="fl">26</span>,</span>
<span>  oversample_ratio <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  min_separation_factor <span class="op">=</span> <span class="fl">0.5</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-feature-mat">feature_mat<a class="anchor" aria-label="anchor" href="#arg-feature-mat"></a></dt>
<dd><p>Numeric matrix (N x M) of compressed features, where each row
is a voxel and each column is a feature dimension. Should be normalized to
unit length for cosine similarity (as output by <code><a href="compress_features_svd.html">compress_features_svd</a></code>).</p></dd>


<dt id="arg-coords">coords<a class="anchor" aria-label="anchor" href="#arg-coords"></a></dt>
<dd><p>Numeric matrix (N x 3) of spatial coordinates for each voxel,
typically in mm units from <code><a href="https://bbuchsbaum.github.io/neuroim2/reference/index_to_coord-methods.html" class="external-link">neuroim2::index_to_coord()</a></code>.</p></dd>


<dt id="arg-k">K<a class="anchor" aria-label="anchor" href="#arg-k"></a></dt>
<dd><p>Integer; target number of seeds (clusters). The function may return
fewer seeds if spatial separation constraints cannot be satisfied.</p></dd>


<dt id="arg-k-neighbors">k_neighbors<a class="anchor" aria-label="anchor" href="#arg-k-neighbors"></a></dt>
<dd><p>Integer; number of nearest neighbors to use for gradient
computation. Default: 26 (full 3D connectivity).</p></dd>


<dt id="arg-oversample-ratio">oversample_ratio<a class="anchor" aria-label="anchor" href="#arg-oversample-ratio"></a></dt>
<dd><p>Numeric; ratio of candidates to K for initial gradient
ranking. Default: 3 (considers top 3*K candidates before applying spatial
separation).</p></dd>


<dt id="arg-min-separation-factor">min_separation_factor<a class="anchor" aria-label="anchor" href="#arg-min-separation-factor"></a></dt>
<dd><p>Numeric; minimum spatial separation between seeds
as a multiple of the expected grid spacing. Default: 1.5 (ensures seeds are
not immediate neighbors).</p></dd>


<dt id="arg-spatial-sigma">spatial_sigma<a class="anchor" aria-label="anchor" href="#arg-spatial-sigma"></a></dt>
<dd><p>Numeric; spatial smoothing parameter for gradient computation.
Larger values create smoother gradient fields. Default: 2.0.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>Integer vector of length &lt;= K containing the row indices of selected
seed voxels in the feature_mat/coords matrices. If fewer than K spatially
separated seeds can be found, a warning is issued.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>

<div class="section">
<h3 id="algorithm">Algorithm<a class="anchor" aria-label="anchor" href="#algorithm"></a></h3>


<p>The seeding process follows these steps:</p><ol><li><p><strong>Functional Gradient Computation</strong>: For each voxel, compute the average
dissimilarity to its k nearest spatial neighbors in feature space:
$$grad(i) = \frac{1}{k} \sum_{j \in N(i)} dist(f_i, f_j)$$
where \(dist(f_i, f_j) = 1 - f_i \cdot f_j\) (cosine distance).</p></li>
<li><p><strong>Candidate Selection</strong>: Rank voxels by gradient value and select the top
K * oversample_ratio voxels with lowest gradient (most stable regions).</p></li>
<li><p><strong>Spatial Separation</strong>: Starting with the lowest-gradient candidate, greedily
select seeds that maintain minimum spatial separation from all previously
selected seeds.</p></li>
</ol></div>

<div class="section">
<h3 id="why-gradient-based-seeding-">Why Gradient-Based Seeding?<a class="anchor" aria-label="anchor" href="#why-gradient-based-seeding-"></a></h3>


<p>Traditional uniform grid seeding often places seeds on functional boundaries
(high gradient regions), leading to:</p><ul><li><p>Poor initial cluster centroids</p></li>
<li><p>Slower convergence</p></li>
<li><p>Less biologically plausible parcellations</p></li>
</ul><p>Gradient-based seeding ensures:</p><ul><li><p>Seeds are in functional cores (low gradient = stable, homogeneous regions)</p></li>
<li><p>Better initial centroids = faster, more accurate clustering</p></li>
<li><p>Biologically plausible: aligns with cortical organization</p></li>
</ul></div>

<div class="section">
<h3 id="comparison-with-other-methods">Comparison with Other Methods<a class="anchor" aria-label="anchor" href="#comparison-with-other-methods"></a></h3>

<ul><li><p><strong>vs. Uniform Grid</strong>: G3S gradient seeding reduces boundary artifacts and
improves convergence speed by 2-3x.</p></li>
<li><p><strong>vs. K-means Initialization</strong>: G3S respects spatial structure, preventing
disconnected clusters.</p></li>
<li><p><strong>vs. Random Seeding</strong>: G3S is deterministic given the data, improving
reproducibility.</p></li>
</ul></div>

    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="compute_functional_gradient.html">compute_functional_gradient</a></code> for gradient computation details.
<code><a href="cluster4d_g3s.html">cluster4d_g3s</a></code> for the full G3S clustering algorithm.
<code><a href="spatial_gradient.html">spatial_gradient</a></code> for spatial-only gradient (used in SNIC).</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># Simulate compressed fMRI features</span></span></span>
<span class="r-in"><span><span class="va">n_voxels</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span></span>
<span class="r-in"><span><span class="va">n_components</span> <span class="op">&lt;-</span> <span class="fl">15</span></span></span>
<span class="r-in"><span><span class="va">features</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n_voxels</span> <span class="op">*</span> <span class="va">n_components</span><span class="op">)</span>, <span class="va">n_voxels</span>, <span class="va">n_components</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">features</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">features</span>, <span class="fl">1</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">x</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>  <span class="co"># Normalize</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Spatial coordinates (10x10x10 grid)</span></span></span>
<span class="r-in"><span><span class="va">coords</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, y <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span>, z <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Find 20 seeds</span></span></span>
<span class="r-in"><span><span class="va">seeds</span> <span class="op">&lt;-</span> <span class="fu">find_gradient_seeds_g3s</span><span class="op">(</span><span class="va">features</span>, <span class="va">coords</span>, K <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">seeds</span><span class="op">)</span><span class="op">)</span>  <span class="co"># Should be 20 or close to it</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Visualize gradient values</span></span></span>
<span class="r-in"><span><span class="va">grad_vals</span> <span class="op">&lt;-</span> <span class="fu"><a href="compute_functional_gradient.html">compute_functional_gradient</a></span><span class="op">(</span><span class="va">features</span>, <span class="va">coords</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">grad_vals</span><span class="op">[</span><span class="va">seeds</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>  <span class="co"># Should be low values</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Bradley Buchsbaum.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

